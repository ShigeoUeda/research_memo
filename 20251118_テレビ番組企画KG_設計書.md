# テレビ番組企画知識グラフ システム設計書

## スキーマ構成（8クラス）

### コアエンティティ（5クラス）

| クラス | 役割 | 主要プロパティ |
|--------|------|---------------|
| **Program** | 番組エンティティ | title, startDate, productionStation, broadcastArea, genre |
| **ProgramFormat** | 番組構造分類 | formatName, formatStructure, typicalDuration |
| **ViewerEmotion** | 視聴感情管理 | emotionName, emotionCategory, intensity |
| **ProductionElement** | 構成要素管理 | elementName, elementCategory, complexity, productionCost |
| **ShiftPattern** | 創造性パターン | patternName, shiftCategory, shiftDegree, riskLevel |

### 文脈クラス（3クラス）

| クラス | 役割 | 主要プロパティ |
|--------|------|---------------|
| **TimeSlot** | 時間的文脈 | slotName, dayType, viewingMode, energyLevel, competingActivities |
| **TargetAudience** | 視聴者文脈 | audienceName, ageRange, mediaLiteracy, valueOrientation |
| **ViewingExpectation** | 動的期待値 | contextName, expectedFormat, expectedElements, acceptableShiftDegree |

---

## リレーション

### 基本リレーション

```
Program -[hasFormat]-> ProgramFormat
Program -[hasElement]-> ProductionElement
Program -[targetEmotion]-> ViewerEmotion
Program -[appliesShift]-> ShiftPattern
Program -[hasTimeSlot]-> TimeSlot
Program -[hasTargetAudience]-> TargetAudience
```

### 文脈生成リレーション

```
TimeSlot + TargetAudience -[generatesExpectation]-> ViewingExpectation
ViewingExpectation -[recommendsShift]-> ShiftPattern
ViewingExpectation -[avoidsShift]-> ShiftPattern
```

### 要素間リレーション

```
ProductionElement -[coOccursWith]-> ProductionElement
ShiftPattern -[combinableWith]-> ShiftPattern
```

---

## RDF-Starメタプロパティ

| プロパティ | 用途 | 値の範囲 | 適用対象 |
|-----------|------|----------|---------|
| frequency | 共起頻度 | 0-∞ | coOccursWith |
| strength | 関連強度 | 0.0-1.0 | coOccursWith |
| shiftDegree | ずらし度 | 0-200 | appliesShift |
| recommendationScore | 推奨スコア | 0-100 | recommendsShift |
| avoidanceScore | 回避スコア | 0-100 | avoidsShift |
| synergyMultiplier | 相乗効果 | 0.5-2.0 | combinableWith |
| confidence | 確信度 | 0.0-1.0 | 各種推論 |

---

## ずらしパターンの体系

### 構造的ずらし（60-200）
- **フォーマット融合** (80): 異なる番組形式の組み合わせ
- **ジャンル破壊** (150): ジャンルの枠を超えた転換
- **ルール破壊** (200): 既存ルールの根本的な変更

### 内容的ずらし（40-120）
- **対象転換** (60): 想定外の対象への焦点変更
- **価値転換** (80): 価値観の逆転や変更
- **役割反転** (100): 立場や役割の入れ替え

### 演出的ずらし（20-80）
- **テンポ操作** (40): リズムや速度の変更
- **視点変更** (60): 見せ方・切り口の変更
- **メタ視点導入** (80): 番組自体を俯瞰する視点

---

## ViewingExpectation動的生成ロジック

### 生成式

```
ViewingExpectation = f(TimeSlot, TargetAudience)
```

### 生成例

| TimeSlot | TargetAudience | 生成される期待値 |
|----------|---------------|-----------------|
| 土曜夜8時 | ファミリー層 | expectedFormat: [対決型, クイズ型]<br>acceptableShiftDegree: 40-120 |
| 平日午後2時 | 主婦層 | expectedFormat: [情報型, 対話型]<br>acceptableShiftDegree: 0-60 |
| 深夜帯 | 若年層 | expectedFormat: [実験型, トーク型]<br>acceptableShiftDegree: 80-200 |

## サンプルデータ

### 番組データ例

```turtle
@prefix tv: <http://example.org/tv-schema/v6#> .

tvd:ps-junkin a tv:Program ;
    tv:title "PS純金" ;
    tv:startDate "2015-04-03"^^xsd:date ;
    tv:productionStation "中京テレビ" ;
    tv:broadcastArea "東海3県" ;
    tv:hasFormat tvd:format_exploration ;
    tv:appliesShift tvd:shift_target_change .
```

### 8.2 共起関係（RDF-Star）

```turtle
<<tvd:element_food tv:coOccursWith tvd:element_battle>>
    tv:frequency 45 ;
    tv:strength 0.75 ;
    tv:lastUpdated "2024-11-20"^^xsd:date .
```

---

## GraphRAG用の検索クエリ

### 類似番組検索

```cypher
MATCH (p1:tv__Program)-[:tv__hasElement]->(e)<-[:tv__hasElement]-(p2:tv__Program)
WHERE p1.tv__title = "オモウマい店" AND p1 <> p2
RETURN p2.tv__title, COUNT(e) as 共通要素数
ORDER BY 共通要素数 DESC
```

### 創造的組み合わせ発見

```cypher
MATCH (e1:tv__ProductionElement), (e2:tv__ProductionElement)
WHERE NOT EXISTS((e1)-[:tv__coOccursWith]-(e2))
AND e1.tv__elementCategory <> e2.tv__elementCategory
RETURN e1.tv__elementName + " × " + e2.tv__elementName as 新組み合わせ
LIMIT 20
```

### 文脈別推奨パターン

```cypher
MATCH (ve:tv__ViewingExpectation {tv__contextName: "土曜夜8時×ファミリー層"})
MATCH (ve)-[r:tv__recommendsShift]->(sp:tv__ShiftPattern)
RETURN sp.tv__patternName, r.recommendationScore
ORDER BY r.recommendationScore DESC
```

---

