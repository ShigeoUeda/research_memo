# GraphRAG テレビ番組企画支援システム - 動作概要

## 1. 研究の背景と目的

### 解決したい課題

テレビ番組企画における **熟練者の暗黙知継承** が困難

- ベテランプロデューサーの退職による知識の断絶
- 「企画の勘所」は言語化・体系化が困難
- 若手ディレクターへの知識継承が課題

### 本研究の目的

> 熟練者の暗黙知を **構造化** し、若手ディレクターの **創造的発想を支援** するシステムを構築する

---

## 2. 従来RAGの問題と提案手法

### 従来RAGの限界（予備実験で確認済み）

```
入力: 「子ども参加の地域探検番組」
        ↓
従来RAG: 「子ども参加」で類似番組を検索
        ↓
取得: 「はじめてのおつかい」など
        ↓
出力: 過去事例の焼き直し ❌
```

**問題点**：過去事例の「内容」を参考にするため、新規性のある企画が生まれない

### 提案手法：構造の転用

```
入力: 「子ども参加の地域探検番組」
        ↓
提案手法: 「役割の反転」という"構造"を抽出
        ↓
転用: 構造を新しい企画に適用
        ↓
出力: 「地元の子どもが観光客をガイドする」 ✓
```

**解決策**：過去事例の「構造（ずらしパターン）」だけを抽出し、新しい企画に転用

---

## 3. システム全体フロー

```mermaid
flowchart TB
    subgraph Step1["Step 1: ユーザー入力"]
        A[企画のもと] --> B[パラメータ設定]
        B --> C[キーワード指定]
    end
    
    subgraph Step2["Step 2: ずらしパターン決定"]
        D[パラメータ → 方向性<br/>ルールベース] --> E[LLMがずらしパターン生成<br/>SCAMPER適用]
    end
    
    subgraph Step3["Step 3: 知識グラフ検索"]
        F[pattern_nameで検索] --> G[成功事例のShiftInstance取得]
    end
    
    subgraph Step4["Step 4: フィルタリング"]
        H[キーワードで除外/優先] --> I[5項目でスコアリング]
    end
    
    subgraph Step5["Step 5: アドバイス生成"]
        J[構造を抽象化] --> K[5フェーズ形式で出力]
    end
    
    Step1 --> Step2
    Step2 --> Step3
    Step3 --> Step4
    Step4 --> Step5
```

### 各Stepの役割

| Step | 主な処理 | 使用技術 | 目的 |
|:----:|---------|---------|------|
| 2 | パラメータ → ずらしパターン | ルールベース + LLM | 構造的な方向性を決定 |
| 3 | パターンで知識グラフ検索 | Neo4j (Cypher) | 検索空間を広げる |
| 4 | キーワードでフィルタリング | LLM | ユーザー意図で絞り込む |
| 5 | 構造転用でアドバイス生成 | LLM | 創造的提案を出力 |

---

## 4. 核となる設計：ずらしパターンの固定化

### 設計方針

**ShiftPattern を 14種類の定義済みパターンとして固定化**

```
知識グラフ: 定義済み14パターンを保持
     ↓
Step 2: LLMは定義リストから選択
     ↓
Step 3: 選択されたpattern_nameで確実に検索
```

### 14種類のずらしパターン

| パターン名 | SCAMPER | 説明 | 例 |
|-----------|---------|------|-----|
| 対象の転換 | S | 焦点を別の要素に移動 | 料理→店主の人間性 |
| 役割の反転 | R | 主客を入れ替え | 大人→子どもが教える |
| 視点の移動 | S | 誰の視点かを変更 | 観光客→地元住民目線 |
| スケールの拡大 | M | 規模・時間を拡大 | 1日→1年密着 |
| スケールの縮小 | M | 規模・時間を縮小 | 全国→商店街 |
| 時間軸の変更 | R | 過去↔現在の入替 | 過去との対比 |
| 要素の移植 | P | 他ジャンルから転用 | バラエティ→情報番組 |
| 要素の組み合わせ | C | 異要素の掛け合わせ | グルメ×謎解き |
| 要素の削除 | E | 当たり前を削る | ナレーション削除 |
| 制約の追加 | A | 条件・ルールを付加 | 予算1000円縛り |
| 構造の再配置 | R | 順序・配置を変更 | 結果を先に見せる |
| 参加者の変更 | S | 出演者属性を変更 | プロ→素人 |
| 場所の転換 | S | 舞台設定を変更 | スタジオ→現場 |
| 目的の転換 | S | ゴールを変更 | 紹介→対決 |

---

## 5. Step 2：パラメータからずらしパターンへ

### ユーザー入力パラメータ（5種類）

| パラメータ | 範囲 | 意味 |
|-----------|:----:|------|
| 冒険度 | 0-100 | 安全 ↔ 挑戦 |
| 独自性 | 0-100 | 王道 ↔ 独創的 |
| 実績重視 | 0-100 | 前例なしOK ↔ 実績重視 |
| ジャンル横断度 | 0-100 | 同ジャンル内 ↔ 異ジャンル融合 |
| ターゲット特化度 | 0-100 | 幅広く ↔ 特定層に刺さる |

### 変換ロジック

```
変化スコア = (冒険度 + 独自性) / 2

  0-25  → 磨き上げ志向（既存の良さを磨く）
 25-45  → ひとひねり志向（王道にひとひねり）
 45-65  → 掛け合わせ志向（異要素を組み合わせ）
 65-85  → 逆転志向（常識を逆転）
 85-100 → 開拓志向（全く新しい領域）
```

### 方向性と推奨パターンの対応

| 方向性 | 推奨パターン |
|--------|-------------|
| 磨き上げ志向 | スケールの拡大/縮小、制約の追加 |
| ひとひねり志向 | 視点の移動、参加者の変更、場所の転換 |
| 掛け合わせ志向 | 要素の組み合わせ、要素の移植 |
| 逆転志向 | 役割の反転、対象の転換、目的の転換 |
| 開拓志向 | 要素の削除、構造の再配置、時間軸の変更 |

---

## 6. Step 3-4：知識グラフ検索とフィルタリング

### 知識グラフの構造

```mermaid
graph LR
    G[Genre<br/>ジャンル] -->|belongsTo| P[Program<br/>番組]
    P -->|appliesShift| SI[ShiftInstance<br/>ずらし適用]
    SI -->|usesPattern| SP[ShiftPattern<br/>ずらしパターン]
    
    style SP fill:#f9f,stroke:#333
    style SI fill:#bbf,stroke:#333
```

### 検索の流れ

```cypher
// Step 3: pattern_nameで検索
MATCH (sp:ShiftPattern {name: "役割の反転"})
      <-[:usesPattern]-(si:ShiftInstance)
      <-[:appliesShift]-(p:Program)
RETURN p.name, si.shiftFrom, si.shiftTo, si.shiftDegree
```

### Step 4 スコアリング（5項目）

| スコア項目 | 何を測るか |
|-----------|----------|
| キーワード関連度 | 重視キーワードとの関連性（LLM判定） |
| shift_degree適合度 | 冒険度・独自性との適合 |
| ジャンル優先度 | 同ジャンル/異ジャンル |
| ターゲット適合度 | 放送時間帯の類似性 |
| 実績スコア | 視聴率・放送年数 |

---

## 7. Step 5：アドバイス生成（5フェーズ構造）

### 出力フォーマット

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
【提案1】地元キッズガイド
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

▼ 創造的提案（150-200字）
  「役割の反転」を適用。地元の小学生が観光客をガイド...

▼ 実現可能性（100-150字）
  ・子役の確保: 地元小学校との連携
  ・安全管理: 保護者同伴で対応

▼ 市場分析（100-150字）
  類似番組との差別化ポイント...

▼ 社会的視点（80-120字）
  地域教育・郷土愛の醸成...

▼ 深掘り質問（50-80字）
  「子どもの成長」をシリーズ化できるか？
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

### 構造転用の流れ

```
成功事例: 「親が買い物する」→「子どもが買い物する」
              ↓ 抽象化
構造: 「通常の担い手」→「意外な担い手」
              ↓ ユーザー企画に適用
提案: 「大人がガイド」→「子どもがガイド」
```

---

## 8. 動作例

### 入力例

```
企画のもと: 「名古屋の隠れた名所を探検する地域密着番組」

パラメータ:
  冒険度: 70 / 独自性: 60 / 実績重視: 50
  ジャンル横断度: 40 / ターゲット特化度: 60

重視: 「子ども参加」「謎解き」「地域活性化」
避ける: 「ランキング形式」「食べ歩きだけ」
ターゲット: 日曜10:00 / ファミリー層
```

### 処理の流れ

```
Step 2-1: 変化スコア = (70+60)/2 = 65 → 逆転志向
          推奨SCAMPER: R (Reverse), S (Substitute)

Step 2-2: LLMが生成
          - 役割の反転: 大人がガイド → 子どもがガイド
          - 視点の移動: 観光客目線 → 地元住民目線
          - 時間軸の変更: 現在 → 過去との対比

Step 3: 「役割の反転」で検索 → 「はじめてのおつかい」等がヒット

Step 4: 「子ども参加」キーワードで優先度UP
        「ランキング形式」に該当する番組を除外

Step 5: 3パターンの創造的提案を生成
```

---

## 9. 現在の進捗状況

### 完了項目 ✅

- [x] システム全体フローの設計
- [x] Step 1: ユーザー入力仕様の定義
- [x] Step 2: パラメータ→方向性の変換ロジック
- [x] Step 2: LLMプロンプトの設計
- [x] Step 3: ShiftPattern 14種類の定義
- [x] Step 3: Cypherクエリの設計
- [x] Step 4: 5項目スコアリングの設計
- [x] Step 5: 5フェーズ出力形式の設計
- [x] ジャンル分類定義

### 次のステップ 🔜

- [ ] 知識グラフへの番組データ登録
- [ ] 各Stepの実装・結合
- [ ] 評価実験の設計・実施
  - 従来RAGとの比較
  - スコアリング重み付けの検証

---

## 10. 従来RAGとの比較（まとめ）

| 項目 | 従来RAG | 提案手法（GraphRAG） |
|------|---------|---------------------|
| **検索対象** | キーワード類似性 | ずらしパターン（構造） |
| **検索空間** | 同ジャンル中心 | ジャンル横断可能 |
| **取得情報** | 番組の内容・詳細 | ずらしの構造（from→to） |
| **LLM入力** | 類似番組の事例 | 構造の転用パターン |
| **生成結果** | 過去事例の焼き直し | 構造転用による新アイデア |

---

## 参考：技術スタック

| コンポーネント | 技術 |
|---------------|------|
| 知識グラフDB | Neo4j 5.20.0 + n10s (RDF-Star) |
| ベクトルDB | ChromaDB |
| LLM | Google Gemini API |
| 実装言語 | Python |
